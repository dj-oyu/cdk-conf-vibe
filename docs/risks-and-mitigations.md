# リスクと緩和策

このドキュメントは、プロジェクトに潜在する技術的リスクと、それに対する緩和策をまとめたものです。

---

## 1. WebRTCメッシュネットワークのスケーラビリティ問題

### 1.1. リスクの概要

当初の `spec.md` では、最大20人の同時接続を想定していましたが、完全なP2Pメッシュネットワークアーキテクチャにおいて、この人数は各クライアントに過大な負荷をかけ、パフォーマンスの低下、遅延の増大、接続の不安定化を招く非常に高いリスクがありました。

### 1.2. 技術的背景

WebRTCメッシュネットワークでは、参加者 (N) が増えるにつれて、各クライアントは他のすべての参加者 (N-1) と直接P2P接続を確立・維持する必要があります。これにより、以下の問題が発生します。

- **CPU負荷の増大:** 各接続ごとにデータのエンコード・デコード処理（本プロジェクトでは主にデータチャネルのシリアライズ/デシリアライズ）が必要となり、クライアントのCPU使用率が参加者数に比例して増加します。
- **アップロード帯域の消費:** 各クライアントは、自身のデータを他の (N-1) 人のピア全員に送信する必要があるため、必要なアップロード帯域が参加者数と共に急増します。これは、一般的な家庭用インターネット回線では特にボトルネックになりやすい点です。

調査によると、ビデオ・音声通信を含む場合、安定したメッシュ接続の実用的な上限は **4〜6人** とされています。本プロジェクトはデータチャネルのみを使用するため、これよりは多くの人数に対応可能ですが、20人という目標は依然として大きな技術的挑戦でした。

### 1.3. 緩和策

**対策:** ルームあたりの**最大参加人数を現実的な数（例: 8人）に制限する。**

この決定により、以下の効果が期待され、リスクは大幅に軽減されます。

- **クライアント負荷の抑制:** 各クライアントが管理する接続数が少なくなるため、CPUとネットワーク帯域への負荷が許容範囲内に収まり、アプリケーションのパフォーマンスと安定性が向上します。
- **アーキテクチャの維持:** この対策により、`spec.md`の核心的な要件である「バックエンド運用コストを極限まで削減」と「100% WebRTC DataChannel メッシュ」というコンセプトを維持したまま、プロジェクトを推進することが可能になります。
- **SFU/MCUサーバーの回避:** より複雑で運用コストのかかるメディアサーバー（SFU/MCU）の導入を回避できます。

今後は、CDKによるバックエンド実装とフロントエンド開発において、この**8人**という上限を前提として設計を進めます。
